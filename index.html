<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ì‚° ë§í¬ ìƒì„±ê¸°</title>
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- QR Code Library CDN ë¡œë“œ (qrcode.js ì‚¬ìš©) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        /* Custom style for the copy success effect */
        .copy-success {
            transition: background-color 0.3s ease-in-out;
        }
    </style>
</head>
<body class="p-4">

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div id="app-container" class="w-full max-w-lg bg-white shadow-xl rounded-xl p-6 md:p-8">
        <h1 class="text-3xl font-extrabold text-center text-indigo-700 mb-6">ì •ì‚° ë§í¬ ìƒì„± ë° ê³µìœ </h1>

        <!-- 1. ì…ë ¥ í¼ (URL íŒŒë¼ë¯¸í„°ê°€ ì—†ì„ ë•Œ í‘œì‹œ) -->
        <div id="input-form-section">
            <div class="space-y-4">
                <p class="text-sm text-gray-500 mb-6 text-center">
                    ì •ì‚° ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ë§í¬ë¥¼ ìƒì„±í•˜ì„¸ìš”. ì´ ë§í¬ë¥¼ QR ì½”ë“œë¡œ ë§Œë“¤ì–´ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>

                <!-- 1.1. ê¸ˆì•¡ ê³„ì‚°/ì…ë ¥ -->
                <div id="amount-input-group" class="p-4 bg-indigo-50 rounded-lg border border-indigo-200">
                    <label for="totalAmount" class="block text-lg font-semibold text-indigo-700 mb-1">ì´ ê¸ˆì•¡ / ì¸ë‹¹ ê¸ˆì•¡ ì„¤ì •</label>
                    <div id="calc-input-group" class="flex items-center space-x-2 mb-2">
                        <!-- ë ˆì´ì•„ì›ƒ ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ flex-1 ëŒ€ì‹  w-5/12 ì‚¬ìš© -->
                        <input type="number" id="totalAmount" placeholder="ì´ ê²°ì œ ê¸ˆì•¡ (ì„ íƒ)" class="w-5/12 p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        <span class="text-gray-500">Ã·</span>
                        <!-- ë ˆì´ì•„ì›ƒ ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ flex-1 ëŒ€ì‹  w-5/12 ì‚¬ìš© -->
                        <input type="number" id="numPeople" placeholder="ì¸ì›ìˆ˜ (ì„ íƒ)" class="w-5/12 p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        <button id="calculateBtn" class="bg-indigo-500 text-white p-3 rounded-lg hover:bg-indigo-600 transition duration-150 whitespace-nowrap">ê³„ì‚°</button>
                    </div>
                    <p id="calc-result" class="text-sm text-gray-600 h-5"></p>
                    
                    <label for="amountPerPerson" class="block text-sm font-medium text-gray-700 mt-4 mb-1">
                        âœ¨ ì¸ë‹¹ ì†¡ê¸ˆì•¡ (í•„ìˆ˜)
                    </label>
                    <input type="number" id="amountPerPerson" required placeholder="ì˜ˆ: 15000" class="w-full p-3 border-2 border-indigo-400 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 font-bold text-xl">
                </div>

                <!-- 1.2. ê³„ì¢Œ ì •ë³´ -->
                <div>
                    <label for="bankName" class="block text-sm font-medium text-gray-700 mb-1">ì€í–‰ëª… (í•„ìˆ˜)</label>
                    <input type="text" id="bankName" required placeholder="ì˜ˆ: ì¹´ì¹´ì˜¤ë±…í¬, êµ­ë¯¼ì€í–‰" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <div>
                    <label for="accountNumber" class="block text-sm font-medium text-gray-700 mb-1">ê³„ì¢Œë²ˆí˜¸ (í•„ìˆ˜)</label>
                    <input type="text" id="accountNumber" required placeholder="ìˆ«ìë§Œ ì…ë ¥í•´ ì£¼ì„¸ìš”" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <div>
                    <label for="accountHolder" class="block text-sm font-medium text-gray-700 mb-1">ì˜ˆê¸ˆì£¼ (í•„ìˆ˜)</label>
                    <input type="text" id="accountHolder" required placeholder="ì˜ˆ: í™ê¸¸ë™" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <button id="generateBtn" class="w-full bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition duration-150 shadow-md">
                    ì •ì‚° ë§í¬ ìƒì„±í•˜ê¸°
                </button>
            </div>
            
            <!-- ìƒì„±ëœ ë§í¬ í‘œì‹œ ì˜ì—­ -->
            <div id="link-output-area" class="mt-8 p-4 bg-gray-100 rounded-lg hidden">
                <p class="font-semibold text-gray-700 mb-2">âœ… ê³µìœ í•  ì •ì‚° ë§í¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤:</p>
                <div class="flex items-center space-x-2">
                    <input type="text" id="generatedLink" readonly class="flex-1 p-3 border border-gray-300 rounded-lg bg-white text-sm truncate">
                    <button id="copyLinkBtn" class="bg-indigo-600 text-white px-4 py-3 rounded-lg hover:bg-indigo-700 transition duration-150 whitespace-nowrap">
                        ë³µì‚¬
                    </button>
                </div>

                <!-- QR ì½”ë“œ ì¶œë ¥ ì˜ì—­ ì¶”ê°€ -->
                <div class="mt-4 p-4 bg-white rounded-lg shadow-inner flex justify-center flex-col items-center">
                    <p class="font-bold text-gray-700 mb-3">ğŸ“¸ QR ì½”ë“œë¡œ ë°”ë¡œ ìŠ¤ìº”í•˜ì„¸ìš”</p>
                    <div id="qrcode-container" class="p-2 border border-gray-300 rounded-lg bg-white">
                        <!-- QR ì½”ë“œê°€ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                    </div>
                </div>

                <p class="text-xs text-red-500 mt-2">
                    * ì´ ë§í¬ë¥¼ QR ì½”ë“œë¡œ ë³€í™˜í•˜ì—¬ ì‚¬ìš©í•˜ê±°ë‚˜ ë©”ì‹œì§€ë¡œ ê³µìœ í•˜ì„¸ìš”.
                </p>
            </div>
        </div>

        <!-- 2. ê²°ê³¼ í‘œì‹œ (URL íŒŒë¼ë¯¸í„°ê°€ ìˆì„ ë•Œ í‘œì‹œ) -->
        <div id="result-display-section" class="hidden text-center">
            <!-- SVG ì•„ì´ì½˜ ìˆ˜ì •: ê¹¨ì§€ëŠ” ì•„ì´ì½˜ ëŒ€ì‹  ì§€ê°‘/ëˆ ëª¨ì–‘ ì•„ì´ì½˜ìœ¼ë¡œ êµì²´ -->
            <svg class="mx-auto h-16 w-16 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            <h2 class="text-3xl font-bold text-gray-800 mt-4">ì •ì‚° ìš”ì²­</h2>
            <p class="text-lg text-gray-600 mt-2 mb-8">ì•„ë˜ ê³„ì¢Œë¡œ ê¸ˆì•¡ì„ ì†¡ê¸ˆí•´ ì£¼ì„¸ìš”.</p>

            <div class="space-y-4 p-6 bg-green-50 rounded-xl border-4 border-green-300 shadow-lg">
                <div class="text-left">
                    <p class="text-2xl font-bold text-green-700">ì†¡ê¸ˆí•  ê¸ˆì•¡</p>
                    <p id="displayAmount" class="text-5xl font-extrabold text-green-900 mt-1">0ì›</p>
                </div>
                
                <div class="border-t border-green-200 pt-4 space-y-2 text-left">
                    <div class="flex justify-between items-center bg-white p-3 rounded-lg">
                        <span class="font-medium text-gray-500">ì€í–‰ëª…</span>
                        <span id="displayBank" class="font-semibold text-gray-800"></span>
                    </div>
                    <div class="flex justify-between items-center bg-white p-3 rounded-lg">
                        <span class="font-medium text-gray-500">ê³„ì¢Œë²ˆí˜¸</span>
                        <span id="displayAccount" class="font-semibold text-gray-800"></span>
                    </div>
                    <div class="flex justify-between items-center bg-white p-3 rounded-lg">
                        <span class="font-medium text-gray-500">ì˜ˆê¸ˆì£¼</span>
                        <span id="displayHolder" class="font-semibold text-gray-800"></span>
                    </div>
                </div>
            </div>

            <p class="text-sm text-gray-500 mt-6">
                í˜ì´ì§€ê°€ ë‹¤ì‹œ í•„ìš”í•˜ë©´ ì´ ë§í¬ë¥¼ ë¶ë§ˆí¬í•˜ê±°ë‚˜ ì €ì¥í•˜ì„¸ìš”.
            </p>
            <button onclick="window.location.href = window.location.pathname" class="mt-4 text-indigo-600 hover:text-indigo-800 font-medium">
                ìƒˆë¡œìš´ ë§í¬ ìƒì„±í•˜ê¸°
            </button>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜ ì„¤ì • (Firebase ëŒ€ì‹  ì •ì  ì›¹í˜ì´ì§€ì´ë¯€ë¡œ URL íŒŒë¼ë¯¸í„° ì‚¬ìš©)
        const amountInput = document.getElementById('amountPerPerson');
        const bankInput = document.getElementById('bankName');
        const accountInput = document.getElementById('accountNumber');
        const holderInput = document.getElementById('accountHolder');
        const generateBtn = document.getElementById('generateBtn');
        const calculateBtn = document.getElementById('calculateBtn');
        const totalAmountInput = document.getElementById('totalAmount');
        const numPeopleInput = document.getElementById('numPeople');
        const calcResult = document.getElementById('calc-result');

        const inputSection = document.getElementById('input-form-section');
        const resultSection = document.getElementById('result-display-section');
        const generatedLinkInput = document.getElementById('generatedLink');
        const copyLinkBtn = document.getElementById('copyLinkBtn');
        const qrcodeContainer = document.getElementById('qrcode-container'); // QR ì½”ë“œ ì»¨í…Œì´ë„ˆ ë³€ìˆ˜ ì¶”ê°€

        /**
         * ìˆ«ìë¥¼ í•œêµ­ í†µí™” í˜•ì‹ìœ¼ë¡œ í¬ë§·í•©ë‹ˆë‹¤.
         * @param {number} number
         */
        const formatCurrency = (number) => {
            return new Intl.NumberFormat('ko-KR', {
                style: 'currency',
                currency: 'KRW',
                minimumFractionDigits: 0
            }).format(number);
        };

        /**
         * ì´ ê¸ˆì•¡ê³¼ ì¸ì›ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¸ë‹¹ ì†¡ê¸ˆì•¡ì„ ê³„ì‚°í•©ë‹ˆë‹¤.
         */
        calculateBtn.addEventListener('click', () => {
            const total = parseInt(totalAmountInput.value);
            const num = parseInt(numPeopleInput.value);

            if (isNaN(total) || isNaN(num) || num <= 0) {
                // ì»¤ìŠ¤í…€ ì•Œë¦¼ UIë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ì„ì‹œë¡œ ì½˜ì†” ë©”ì‹œì§€ë¡œ ëŒ€ì²´
                console.error('ì´ ê¸ˆì•¡ê³¼ ì¸ì›ìˆ˜ë¥¼ ì •í™•íˆ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                calcResult.textContent = 'ì´ ê¸ˆì•¡ê³¼ ì¸ì›ìˆ˜ë¥¼ ì •í™•íˆ ì…ë ¥í•´ ì£¼ì„¸ìš”.';
                return;
            }

            const perPerson = Math.ceil(total / num); // ì˜¬ë¦¼ ì²˜ë¦¬í•˜ì—¬ ê³„ì‚°
            amountInput.value = perPerson;
            calcResult.textContent = `ê³„ì‚° ê²°ê³¼: ì¸ë‹¹ ${formatCurrency(perPerson)} (${total} Ã· ${num})`;
        });

        /**
         * ì…ë ¥ í•„ë“œë¥¼ ë¹„í™œì„±í™”í•˜ê³  ê´€ë ¨ ë²„íŠ¼ì„ ìˆ¨ê¹ë‹ˆë‹¤.
         */
        function disableInputFields() {
            // 1. í•„ìˆ˜ ì…ë ¥ í•„ë“œë¥¼ ì½ê¸° ì „ìš©ìœ¼ë¡œ ì„¤ì • ë° ìŠ¤íƒ€ì¼ ë³€ê²½
            const primaryInputs = [amountInput, bankInput, accountInput, holderInput];
            
            primaryInputs.forEach(input => {
                input.setAttribute('readonly', true);
                // ì½ê¸° ì „ìš© ìƒíƒœë¥¼ ëª…í™•íˆ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ìŠ¤íƒ€ì¼ ë³€ê²½
                input.classList.add('bg-gray-100', 'text-gray-700', 'cursor-default');
                input.classList.remove('focus:ring-indigo-500', 'focus:border-indigo-500', 'border-indigo-400');
            });
            
            // 2. ê³„ì‚° ê´€ë ¨ í•„ë“œ/ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            const calcInputGroup = document.getElementById('calc-input-group');
            if (calcInputGroup) {
                calcInputGroup.classList.add('hidden');
            }
            calcResult.classList.add('hidden');
            
            // 3. ì •ì‚° ë§í¬ ìƒì„±í•˜ê¸° ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            generateBtn.classList.add('hidden');
        }

        /**
         * ì…ë ¥ëœ ì •ë³´ë¥¼ URL íŒŒë¼ë¯¸í„°ë¡œ ì¸ì½”ë”©í•˜ì—¬ ë§í¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
         */
        generateBtn.addEventListener('click', () => {
            const amount = amountInput.value.trim();
            const bank = bankInput.value.trim();
            const account = accountInput.value.trim();
            const holder = holderInput.value.trim();

            if (!amount || !bank || !account || !holder) {
                // ì»¤ìŠ¤í…€ ì•Œë¦¼ UIë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ì„ì‹œë¡œ ì½˜ì†” ë©”ì‹œì§€ë¡œ ëŒ€ì²´
                console.error('ëª¨ë“  í•„ìˆ˜ ì •ë³´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                return;
            }

            if (isNaN(parseInt(amount))) {
                // ì»¤ìŠ¤í…€ ì•Œë¦¼ UIë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ì„ì‹œë¡œ ì½˜ì†” ë©”ì‹œì§€ë¡œ ëŒ€ì²´
                console.error('ì†¡ê¸ˆì•¡ì€ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            // URL íŒŒë¼ë¯¸í„°ì— ë“¤ì–´ê°ˆ ë°ì´í„°ë¥¼ ì •ì˜ (ê°„ê²°í•œ íŒŒë¼ë¯¸í„° ì´ë¦„ ì‚¬ìš©)
            const params = new URLSearchParams();
            params.append('a', amount); // Amount
            params.append('b', bank);   // Bank Name
            params.append('c', account);// Account Number
            params.append('d', holder); // Account Holder

            // í˜„ì¬ URLì˜ ê²½ë¡œ + ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ìœ¼ë¡œ ë§í¬ ìƒì„±
            const generatedUrl = window.location.origin + window.location.pathname + '?' + params.toString();
            
            generatedLinkInput.value = generatedUrl;
            document.getElementById('link-output-area').classList.remove('hidden');

            // --- QR ì½”ë“œ ìƒì„± ë¡œì§ ---
            qrcodeContainer.innerHTML = ''; // ê¸°ì¡´ QR ì½”ë“œ ì‚­ì œ

            new QRCode(qrcodeContainer, {
                text: generatedUrl,
                width: 180,
                height: 180,
                colorDark : "#000000",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H // ë†’ì€ ì—ëŸ¬ ë³´ì • ë ˆë²¨
            });
            // ------------------------

            // --- ìƒˆë¡œ ì¶”ê°€ëœ ê¸°ëŠ¥: ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™” ë° ë²„íŠ¼ ìˆ¨ê¸°ê¸° ---
            disableInputFields(); 
        });

        /**
         * ìƒì„±ëœ ë§í¬ë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬í•©ë‹ˆë‹¤.
         */
        copyLinkBtn.addEventListener('click', () => {
            generatedLinkInput.select();
            // navigator.clipboard.writeText(generatedLinkInput.value)ë¥¼ iFrame í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ê¸° ì–´ë µê¸° ë•Œë¬¸ì— êµ¬ì‹ ë°©ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    // ë³µì‚¬ ì„±ê³µ ì‹œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½
                    copyLinkBtn.textContent = 'âœ… ë³µì‚¬ ì™„ë£Œ!';
                    copyLinkBtn.classList.add('bg-green-500', 'hover:bg-green-500');
                    copyLinkBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                    setTimeout(() => {
                        copyLinkBtn.textContent = 'ë³µì‚¬';
                        copyLinkBtn.classList.remove('bg-green-500', 'hover:bg-green-500');
                        copyLinkBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
                    }, 1500);
                } else {
                    console.error('ë³µì‚¬ ëª…ë ¹ ì‹¤íŒ¨');
                }
            } catch (err) {
                console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì˜¤ë¥˜:', err);
                // ì»¤ìŠ¤í…€ ì•Œë¦¼ UIë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ì„ì‹œë¡œ ì½˜ì†” ë©”ì‹œì§€ë¡œ ëŒ€ì²´
            }
        });

        /**
         * URL íŒŒë¼ë¯¸í„°ë¥¼ í™•ì¸í•˜ê³  ë°ì´í„°ë¥¼ ë³µì›í•˜ì—¬ í‘œì‹œí•©ë‹ˆë‹¤.
         */
        function checkAndDisplayData() {
            const urlParams = new URLSearchParams(window.location.search);
            
            // í•„ìˆ˜ íŒŒë¼ë¯¸í„° í™•ì¸: a (amount), b (bank), c (account), d (holder)
            const amount = urlParams.get('a');
            const bank = urlParams.get('b');
            const account = urlParams.get('c');
            const holder = urlParams.get('d');

            if (amount && bank && account && holder) {
                // ë°ì´í„°ê°€ ìˆì„ ê²½ìš°: ê²°ê³¼ í‘œì‹œ ì„¹ì…˜ í™œì„±í™”
                inputSection.classList.add('hidden');
                resultSection.classList.remove('hidden');

                document.getElementById('displayAmount').textContent = formatCurrency(parseInt(amount));
                document.getElementById('displayBank').textContent = decodeURIComponent(bank);
                document.getElementById('displayAccount').textContent = decodeURIComponent(account);
                document.getElementById('displayHolder').textContent = decodeURIComponent(holder);

            } else {
                // ë°ì´í„°ê°€ ì—†ì„ ê²½ìš°: ì…ë ¥ í¼ ì„¹ì…˜ í™œì„±í™”
                inputSection.classList.remove('hidden');
                resultSection.classList.add('hidden');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì •ì‚° ë°ì´í„° ë³µì› ë¡œì§ ì‹¤í–‰
        window.onload = checkAndDisplayData;
    </script>
</body>
</html>
